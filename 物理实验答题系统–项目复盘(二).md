# 物理实验答题系统–项目复盘(二)

## 一、 问题1：

当某个学生重复做同一个实验时，student表和答案表里面会有很多个同一个学生同一个实验的记录

后果：老师在后台查看学生成绩表时，会看到同一个学生的很多条记录

解决：在学生填写个人信息的时候查询student表中是否有重复的记录，如果有，就直接返回该学生id；否则存入该学生的信息之后再返回id

## 二、问题2：

在学生信息提交时，如果快速点击按钮，就会在短时间内多次访问路由

后果：会出现student表中相同信息的两条或多条记录，同一个学生的同一个实验id有多个，进入下一个页面的时候返回的是哪一个id呢？当提交答案之后，有一个成绩是有答案的，但是其他的答案就为0.

解决：429设置：在laravel_api接口有一个中间件叫throttle，他是laravel api开发中限制路由访问次数的中间件。throttle:60,1  表示的是一分钟限制60次访问，如果访问超限，就会报429错误，我们以此来控制学生的频繁点击按钮。对应的配置在app/Http/kernel.php 中。

## 三、问题3：

在问题1中解决了每个学生只能做一次题的问题，但如果这个时候，如果某个学生填了个人信息表，提交后加入答题页面又退出去了，这个时候

后果：在教师端是可以看到这个学生的记录，但是分数是0分，pdf也不能导出，怎么做个标记？

解决：添加状态码，填写了个人信息但是没有答题的状态为1；提交了答案的状态为2.

## 四、问题4：

此时又会遇到：状态码为1的学生第二次填写了个人信息提交后，后端会查询student表里面是否有该学生的相同实验记录和状态码的状态为多少，若为1直接get()封装该数据返回给前端

后果：前端不能直接获取id，因为前端收到的是一个数组

解决：因为返回的数组中就只有一个值，所以直接把数组中的第一个值取出来返回给前端

## 五、问题5：

老师要求我们实现：学生输入的是几位小数，pdf导出时上面就显示多少位小数，但是由于不管我们怎么获取，只要数据库里面设置了是几位小数，他存进去就会变成几位小数

解决：将数据库里面的float 改为 varchar 型

## 六、问题6：

因为问题5的解决方式，导致学生端输入非法数字时，也可以存答案，但是无法跳转页面，显示提交不成功，此时页面上会报500的错

后果：答案表里面会有记录答案，状态码是为2的，但是分数依然是0，因为在判分的时候会因为非法数字无法判断，因而就卡在那里；导致教师端可以看到该生的记录，显示也是已经完成了的，pdf也能导出可以看到答案。

解决：前端加上了number类型的限制，如果输入的不是数字，就不能输入除数字以外的任何东西；后面优化的话，后端就需要在表单验证中添加数据类型的验证

## 七、问题7：

老师要求判断数字的有效位数

解决：在Helpers文件里写一个公共方法

## 经验：

1. 不管是路由还是Controller层还是Model层的方法，都要把注解写好
2. 接口文档一定要按照接口文档中写的多测几遍
3. 在视图里遇到特殊标签时，要注意存储格式。